task:
  name: rotate_1024_arm
  task_name: rotate_1024_arm
  shape_meta:
    obs:
      image:
        shape:
        - 3
        - 224
        - 224
        type: rgb
      point_cloud:
        shape:
        - 2048
        - 6
        type: point_cloud
      agent_pos:
        shape:
        - 23
        type: low_dim
    action:
      shape:
      - 23
  env_runner:
    _target_: diffusion_policy_3d.env_runner.rotate_runner.Rotate
    eval_episodes: 20
    max_steps: 1000
    n_obs_steps: ${n_obs_steps}
    n_action_steps: ${n_action_steps}
    fps: 10
    task_name: rotate
    render_size: 84
    use_point_crop: ${policy.use_point_crop}
    env_num: 1
    fake_env: true
    state_shape: 6
    num_points: ${shape_meta.obs.point_cloud.shape[0]}
    use_rgb: false
    save_image: false
  norm_dataset:
    _target_: diffusion_policy_3d.dataset.rotate_dataset.RotateDataset
    zarr_path: data/data_rotate_100_arm_1024.zarr
    horizon: ${horizon}
    pad_before: ${eval:'${n_obs_steps}-1'}
    pad_after: ${eval:'${n_action_steps}-1'}
    seed: 42
    val_ratio: 0.02
    max_train_episodes: 9000000
    pre_image_norm: false
  dataset:
    _target_: diffusion_policy_3d.dataset.rotate_dataset_pc.RotateDataset
    zarr_path: data/data_rotate_2048_0606_1.zarr
    horizon: ${horizon}
    pad_before: ${eval:'${n_obs_steps}-1'}
    pad_after: ${eval:'${n_action_steps}-1'}
    seed: 42
    val_ratio: 0.02
    max_train_episodes: 9000000
    pre_image_norm: false
  critic_dataset:
    _target_: diffusion_policy_3d.dataset.rotate_dataset.RotateDataset
    zarr_path: data/data_rotate_100_arm_1024.zarr
    horizon: ${horizon}
    pad_before: ${eval:'${n_obs_steps}-1'}
    pad_after: ${eval:'${n_action_steps}-1'}
    seed: 42
    val_ratio: 0.0
    max_train_episodes: 9000000
    pre_image_norm: false
  scale_dataset:
    _target_: diffusion_policy_3d.dataset.rotate_dataset.RotateDataset
    zarr_path: data/data_rotate_100_arm_1024.zarr
    horizon: ${horizon}
    pad_before: ${eval:'${n_obs_steps}-1'}
    pad_after: ${eval:'${n_action_steps}-1'}
    seed: 42
    val_ratio: 0.0
    max_train_episodes: 9000000
    scale_strategy: dynamic
    pre_image_norm: false
name: train_dp3
task_name: ${task.name}
shape_meta: ${task.shape_meta}
exp_name: rotate_2048-dp3-0112
horizon: 3
n_obs_steps: 3
n_action_steps: 1
n_latency_steps: 0
dataset_obs_steps: ${n_obs_steps}
keypoint_visible_rate: 1.0
obs_as_global_cond: true
use_action_embed: true
no_pre_action: true
ft_all_actions: false
eval: false
offline: true
online: false
num_inference_steps: 10
cm_inference_steps: 1
clip_std_min: 0.0067
clip_std_max: null
action_norm: true
env_num: ${task.env_runner.env_num}
only_bc: true
extractor_name: smallpn
distill_phase: after_dp
wandb: true
load_path: best
eval_stage: dp3
load_bc: false
use_wandb: true
off2off: false
off2off_no_bc: false
accelerate: false
policy:
  _target_: diffusion_policy_3d.policy.dp3.DP3
  use_point_crop: true
  condition_type: film
  use_down_condition: true
  use_mid_condition: true
  use_up_condition: true
  joint_opt_encoder: true
  policy_layer_norm: true
  backbone: null
  integrate_strategy: concat
  model: skipnet
  act: relu
  encoder_type: pointnet
  point_downsample: true
  diffusion_step_embed_dim: 256
  mlp_policy_depth: 3
  down_dims:
  - 256
  - 512
  - 1024
  crop_shape:
  - 80
  - 80
  encoder_output_dim: 64
  horizon: ${horizon}
  kernel_size: 5
  n_action_steps: ${n_action_steps}
  n_groups: 8
  n_obs_steps: ${n_obs_steps}
  num_inference_steps: ${num_inference_steps}
  scheduler_type: ddim
  img_shape:
  - 3
  - 84
  - 84
  use_agent_pos: true
  cm_noise_scheduler:
    _target_: diffusion_policy_3d.unidpg.diffusion_policy.diffusers_patch.lcm_scheduler.LCMSchedulerExtended
    num_train_timesteps: 50
    beta_start: 0.00085
    beta_end: 0.012
    beta_schedule: scaled_linear
    clip_sample: true
    set_alpha_to_one: true
    steps_offset: 0
    prediction_type: epsilon
    original_inference_steps: ${num_inference_steps}
    clip_std_min: ${clip_std_min}
    clip_std_max: ${clip_std_max}
  ddim_noise_scheduler:
    _target_: diffusion_policy_3d.unidpg.diffusion_policy.diffusers_patch.ddim_with_logprob_dpok.DDIMSchedulerExtended
    num_train_timesteps: 50
    beta_start: 0.0001
    beta_end: 0.02
    beta_schedule: squaredcos_cap_v2
    clip_sample: true
    set_alpha_to_one: true
    steps_offset: 1
    prediction_type: sample
    clip_std_min: ${clip_std_min}
    clip_std_max: ${clip_std_max}
  obs_as_global_cond: true
  shape_meta: ${shape_meta}
  use_pc_color: true
  pointnet_type: pointnet
  idp3_pointcloud_encoder_cfg:
    in_channels: 3
    out_channels: ${policy.encoder_output_dim}
    use_layernorm: true
    final_norm: layernorm
    normal_channel: false
    num_points: 512
  pointcloud_encoder_cfg:
    in_channels: 3
    out_channels: ${policy.encoder_output_dim}
    use_layernorm: true
    final_norm: layernorm
    normal_channel: false
ema:
  _target_: diffusion_policy_3d.model.diffusion.ema_model.EMAModel
  update_after_step: 0
  inv_gamma: 1.0
  power: 0.75
  min_value: 0.0
  max_value: 0.9999
dataloader:
  batch_size: 128
  num_workers: 8
  shuffle: true
  pin_memory: true
  persistent_workers: false
val_dataloader:
  batch_size: 128
  num_workers: 8
  shuffle: false
  pin_memory: true
  persistent_workers: false
optimizer:
  _target_: torch.optim.AdamW
  lr: 0.0001
  betas:
  - 0.95
  - 0.999
  eps: 1.0e-08
  weight_decay: 1.0e-06
training:
  device: cuda:0
  gpu_id: 0
  seed: 50
  debug: false
  resume: true
  lr_scheduler: cosine
  lr_warmup_steps: 500
  num_epochs: 1500
  num_critic_epochs: 600
  gradient_accumulate_every: 1
  use_ema: true
  rollout_every: 50
  checkpoint_every: 50
  val_every: 1
  sample_every: 5
  max_train_steps: null
  max_val_steps: null
  tqdm_interval_sec: 1.0
logging:
  group: ${exp_name}
  id: null
  mode: offline
  name: ${training.seed}
  project: ${name}+${task_name}
  resume: false
  tags:
  - ft-dp3
checkpoint:
  save_ckpt: true
  topk:
    monitor_key: test_mean_score
    mode: max
    k: 1
    format_str: epoch={epoch:04d}-test_mean_score={test_mean_score:.3f}.ckpt
  save_last_ckpt: true
  save_last_snapshot: false
multi_run:
  run_dir: data/outputs/${task.name}/${training.seed}/${now:%Y.%m.%d}/${now:%H.%M.%S}_${name}_${task_name}
  wandb_name_base: ${now:%Y.%m.%d-%H.%M.%S}_${name}_${task_name}
critic:
  q_hidden_dim: 512
  q_depth: 2
  q_lr: 0.0001
  target_update_freq: 2
  tau: 0.005
  gamma: 0.99
  v_hidden_dim: 512
  v_depth: 2
  v_lr: 0.0001
  omega: 0.7
  is_double_q: true
  is_iql: true
  is_share_encoder: true
  fix_encoder: true
  resume: true
  load_pretrain: true
unio4:
  bppo_steps: 5000
  bppo_lr: 1.0e-06
  clip_ratio: 0.25
  entropy_weight: 0.0
  decay: 0.96
  omega: 0.7
  is_clip_decay: true
  is_bppo_lr_decay: false
  is_update_old_policy: true
  is_linear_decay: true
  bppo_batch_size: 512
  temperature: null
  eval_step: 50
  eval_freq: 1000
  ratio_strategy: sum
  is_ddpo: true
  top_k: 1
  fix_encoder: true
  rollout_length: 20
  use_gae: true
  first_action: false
  use_ema_eval: false
  idql_eval: true
  eval_times: 1
dynamics:
  gamma: 0.99
  tau: 0.005
  alpha: 0.1
  auto_alpha: true
  target_entropy: null
  alpha_lr: 3.0e-05
  deterministic_backup: true
  max_q_backup: true
  norm_reward: true
  num_q_ensemble: 10
  dynamics_lr: 0.0003
  dynamics_max_epochs: 250
  max_epochs_since_update: 20
  dynamics_hidden_dims:
  - 400
  - 400
  - 400
  - 400
  dynamics_weight_decay:
  - 2.5e-05
  - 5.0e-05
  - 7.5e-05
  - 7.5e-05
  - 0.0001
  n_ensemble: 7
  n_elites: 5
  rollout_freq: 1000
  rollout_batch_size: 50000
  rollout_length: 20
  penalty-coef: 1.0
  num_samples: 10
  model_retain_epochs: 5
  real_ratio: 0.05
  load_dynamics_path: null
  epoch: 200
  step_per_epoch: 1000
  eval_episodes: 10
  batch_size: 256
  lr_scheduler: false
  penalty_coef: 0.5
  predict_delta: true
  first_action: false
  fix_encoder: true
  tqdm_interval_sec: 1.0
ppo:
  env_name: ${task.name}
  seed: ${training.seed}
  max_train_steps: 1000000
  evaluate_freq: 20000
  save_freq: 20
  batch_size: 2048
  mini_batch_size: 128
  gpu: ${training.device}
  path: null
  v_hidden_width: 512
  v_depth: 3
  lr_bc: 0.0001
  lr_a: 3.0e-06
  lr_c: 0.0003
  gamma: 0.99
  lamda: 0.95
  epsilon: 0.2
  K_epochs: 10
  use_adv_norm: true
  use_state_norm: true
  use_reward_norm: false
  use_reward_scaling: true
  entropy_coef: 0.01
  use_lr_decay: true
  use_grad_clip: true
  use_orthogonal_init: true
  set_adam_eps: true
  use_tanh: true
  is_from_bppo: false
  is_load_value: false
  pi_load_path: pi_
  v_load_path: /home/lk/mobile-main/logs_clip
  r_scale: 1.0
  is_clip_value: true
  is_decay_pi: false
  tau: 0.005
  std_upper_bound: 0.0
  is_dp: true
  T: 5
  beta_schedule: vp
  is_timesteps: false
  num_inference_steps: ${num_inference_steps}
  ratio: 5
  ratio_strategy: sum
  is_ddpo: false
  top_k: 1
  iterations: 50
  update_distribution: false
  bc_in_loop: false
  update_strategy: model
  critic_strategy: iql
  eta: 1.0
  fix_encoder: false
  idql_eval: false
  use_bc: false
  share_encoder: false
  capacity: 500000
  iql_ft: false
  ft_q_lr: 0.0001
  ft_v_lr: 0.0001
  scale_strategy: null
  num_critic_epochs: 200
  encoder_lr_scale: 1.0
  actor_grad: true
  online_start_training: 5000
  clip_std_decay: false
  adaptive_kl: 0.02
  min_lr_actor: 5.0e-07
  max_lr_actor: 1.0e-05
  min_lr_critic: 0.0001
  max_lr_critic: 0.001
  iql_adv: false
  iql_steps: 20
  iql_omega: 0.7
  fix_iql_encoder: true
  iql_q_encoder: false
  iql_v_encoder: false
  v_encoder: false
  load_online_cp: false
  save_online_cp: false
  online_cp_save_freq: 2
online_v:
  state_dim: null
  v_hidden_width: 256
  v_depth: 3
  lr: 0.0001
  device: ${training.device}
